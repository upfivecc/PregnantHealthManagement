<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>孕妇健康管理系统 - 管理后台</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="./css/admin.css">
</head>
<body>
    <div class="admin-container">
        <!-- 侧边栏 -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-baby"></i>
                    </div>
                    <div class="logo-text">孕妇健康管理系统</div>
                </div>
                <button class="toggle-btn" id="toggleSidebar">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            
            <div class="sidebar-menu">
                <div class="menu-item active" data-page="dashboard">
                    <i class="fas fa-home"></i>
                    <span>仪表盘</span>
                </div>
                <div class="menu-item" data-page="users">
                    <i class="fas fa-users"></i>
                    <span>用户管理</span>
                </div>
                <div class="menu-item" data-page="doctors">
                    <i class="fas fa-user-md"></i>
                    <span>医生管理</span>
                </div>
                <div class="menu-item" data-page="appointments">
                    <i class="fas fa-calendar-check"></i>
                    <span>预约管理</span>
                </div>
                <div class="menu-item" data-page="knowledge">
                    <i class="fas fa-book-medical"></i>
                    <span>知识管理</span>
                </div>
                <div class="menu-item" data-page="consultations">
                    <i class="fas fa-comments"></i>
                    <span>咨询管理</span>
                </div>
            </div>
        </div>
        
        <!-- 主内容区 -->
        <div class="main-content">
            <!-- 顶部导航栏 -->
            <div class="header">
                <div class="header-left">
                    <h1 id="pageTitle">仪表盘</h1>
                </div>
                <div class="header-right">
                    <div class="user-profile">
                        <div class="user-avatar">管</div>
                        <div class="user-name">管理员</div>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
            </div>
            
            <!-- 内容区域 -->
            <div class="content">
                <!-- 仪表盘页面 -->
                <div class="page fade-in" id="dashboardPage">
                    <div class="stat-cards">
                        <div class="stat-card">
                            <div class="stat-icon users">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="userCount">0</h3>
                                <p>用户总数</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon doctors">
                                <i class="fas fa-user-md"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="doctorCount">0</h3>
                                <p>医生总数</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon appointments">
                                <i class="fas fa-calendar-check"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="todayAppointmentCount">0</h3>
                                <p>今日预约</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon consultations">
                                <i class="fas fa-comments"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="unrepliedCount">0</h3>
                                <p>未回复咨询</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">系统公告</div>
                        </div>
                        <div class="card-body">
                            <p>欢迎使用孕妇健康管理系统管理后台</p>
                        </div>
                    </div>
                </div>
                
                <!-- 用户编辑模态框 -->
                <div class="modal" id="userModal" style="display: none;">
                    <div class="modal-dialog">
                        <div class="modal-header">
                            <h3 id="modalTitle">编辑用户</h3>
                            <button class="btn btn-outline" id="closeModal">&times;</button>
                        </div>
                        <div class="modal-body">
                            <form id="userForm">
                                <input type="hidden" id="userId">
                                <div class="form-group">
                                    <label>用户名</label>
                                    <input type="text" class="form-control" id="username" required>
                                </div>
                                <div class="form-group">
                                    <label>密码</label>
                                    <input type="password" class="form-control" id="password" required>
                                </div>
                                <div class="form-group">
                                    <label>邮箱</label>
                                    <input type="email" class="form-control" id="email">
                                </div>
                                <div class="form-group">
                                    <label>真实姓名</label>
                                    <input type="text" class="form-control" id="realName">
                                </div>
                                <div class="form-group">
                                    <label>角色</label>
                                    <select class="form-control" id="role">
                                        <option value="USER">普通用户</option>
                                        <option value="DOCTOR">医生</option>
                                        <option value="ADMIN">管理员</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>状态</label>
                                    <select class="form-control" id="status">
                                        <option value="1">启用</option>
                                        <option value="0">禁用</option>
                                    </select>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline" id="cancelBtn">取消</button>
                            <button class="btn btn-primary" id="saveUserBtn">保存</button>
                        </div>
                    </div>
                </div>
                
                <!-- 用户管理页面 -->
                <div class="page fade-in" id="usersPage" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">用户管理</div>
                            <button class="btn btn-primary" id="addUserBtn">
                                <i class="fas fa-plus"></i> 添加用户
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>用户名</label>
                                    <input type="text" class="form-control" placeholder="请输入用户名">
                                </div>
                                <div class="form-group">
                                    <label>角色</label>
                                    <select class="form-control">
                                        <option value="">全部</option>
                                        <option value="USER">普通用户</option>
                                        <option value="DOCTOR">医生</option>
                                        <option value="ADMIN">管理员</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>&nbsp;</label>
                                    <button class="btn btn-primary">
                                        <i class="fas fa-search"></i> 查询
                                    </button>
                                </div>
                            </div>
                            
                            <div class="table-container">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>用户名</th>
                                            <th>邮箱</th>
                                            <th>真实姓名</th>
                                            <th>角色</th>
                                            <th>状态</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- 动态生成用户列表 -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="pagination">
                                <div class="page-info">显示 0 到 0 条记录，共 0 条</div>
                                <div class="page-controls">
                                    <button class="btn btn-outline" id="prevUserPage"><i class="fas fa-chevron-left"></i></button>
                                    <button class="btn btn-primary" id="currentUserPageNum">1</button>
                                    <button class="btn btn-outline" id="nextUserPage"><i class="fas fa-chevron-right"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 医生编辑模态框 -->
                <div class="modal" id="doctorModal" style="display: none;">
                    <div class="modal-dialog">
                        <div class="modal-header">
                            <h3 id="doctorModalTitle">编辑医生</h3>
                            <button class="btn btn-outline" id="closeDoctorModal">&times;</button>
                        </div>
                        <div class="modal-body">
                            <form id="doctorForm">
                                <input type="hidden" id="doctorId">
                                <div class="form-group">
                                    <label>用户ID</label>
                                    <input type="number" class="form-control" id="doctorUserId" required>
                                </div>
                                <div class="form-group">
                                    <label>医院</label>
                                    <input type="text" class="form-control" id="doctorHospital" required>
                                </div>
                                <div class="form-group">
                                    <label>科室</label>
                                    <input type="text" class="form-control" id="doctorDepartment" required>
                                </div>
                                <div class="form-group">
                                    <label>职称</label>
                                    <input type="text" class="form-control" id="doctorTitle" required>
                                </div>
                                <div class="form-group">
                                    <label>专长</label>
                                    <input type="text" class="form-control" id="doctorSpecialty">
                                </div>
                                <div class="form-group">
                                    <label>简介</label>
                                    <textarea class="form-control" id="doctorIntroduction" rows="3"></textarea>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline" id="cancelDoctorBtn">取消</button>
                            <button class="btn btn-primary" id="saveDoctorBtn">保存</button>
                        </div>
                    </div>
                </div>
                
                <!-- 医生管理页面 -->
                <div class="page fade-in" id="doctorsPage" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">医生管理</div>
                            <button class="btn btn-primary" id="addDoctorBtn">
                                <i class="fas fa-plus"></i> 添加医生
                            </button>
                        </div>
                        <div class="card-body">
                            <!-- 添加查询表单 -->
                            <div class="form-row">
                                <div class="form-group">
                                    <label>医生姓名</label>
                                    <input type="text" class="form-control" id="doctorRealName" placeholder="请输入医生姓名">
                                </div>
                                <div class="form-group">
                                    <label>&nbsp;</label>
                                    <button class="btn btn-primary" id="searchDoctorBtn">
                                        <i class="fas fa-search"></i> 查询
                                    </button>
                                    <button class="btn btn-outline" id="resetDoctorBtn">
                                        <i class="fas fa-refresh"></i> 重置
                                    </button>
                                </div>
                            </div>
                            
                            <div class="table-container">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>用户ID</th>
                                            <th>医院</th>
                                            <th>科室</th>
                                            <th>职称</th>
                                            <th>专长</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- 动态生成医生列表 -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="pagination">
                                <div class="page-info">显示 0 到 0 条记录，共 0 条</div>
                                <div class="page-controls">
                                    <button class="btn btn-outline" onclick="loadDoctorList(currentDoctorPage - 1)" id="prevDoctorPage"><i class="fas fa-chevron-left"></i></button>
                                    <button class="btn btn-primary" id="currentDoctorPageNum">1</button>
                                    <button class="btn btn-outline" onclick="loadDoctorList(currentDoctorPage + 1)" id="nextDoctorPage"><i class="fas fa-chevron-right"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 预约管理页面 -->
                <div class="page fade-in" id="appointmentsPage" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">预约管理</div>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>用户</th>
                                            <th>医院</th>
                                            <th>科室</th>
                                            <th>医生职称</th>
                                            <th>预约时间</th>
                                            <th>状态</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>1</td>
                                            <td>张三</td>
                                            <td>北京协和医院</td>
                                            <td>妇产科</td>
                                            <td>主任医师</td>
                                            <td>2023-06-15 10:00</td>
                                            <td><span class="tag tag-success">已确认</span></td>
                                            <td>
                                                <div class="table-actions">
                                                    <button class="btn btn-outline">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                    <button class="btn btn-danger">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="pagination">
                                <div class="page-info">显示 1 到 1 条记录，共 1 条</div>
                                <div class="page-controls">
                                    <button class="btn btn-outline"><i class="fas fa-chevron-left"></i></button>
                                    <button class="btn btn-primary">1</button>
                                    <button class="btn btn-outline"><i class="fas fa-chevron-right"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 知识管理页面 -->
                <div class="page fade-in" id="knowledgePage" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">知识管理</div>
                            <button class="btn btn-primary" id="addKnowledgeBtn">
                                <i class="fas fa-plus"></i> 发布知识
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>标题</th>
                                            <th>分类</th>
                                            <th>状态</th>
                                            <th>创建时间</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>1</td>
                                            <td>孕期营养指南</td>
                                            <td>营养</td>
                                            <td><span class="tag tag-success">已发布</span></td>
                                            <td>2023-06-01</td>
                                            <td>
                                                <div class="table-actions">
                                                    <button class="btn btn-outline">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                    <button class="btn btn-outline">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button class="btn btn-danger">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>2</td>
                                            <td>产检时间安排</td>
                                            <td>产检</td>
                                            <td><span class="tag tag-success">已发布</span></td>
                                            <td>2023-06-05</td>
                                            <td>
                                                <div class="table-actions">
                                                    <button class="btn btn-outline">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                    <button class="btn btn-outline">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button class="btn btn-danger">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="pagination">
                                <div class="page-info">显示 1 到 2 条记录，共 2 条</div>
                                <div class="page-controls">
                                    <button class="btn btn-outline"><i class="fas fa-chevron-left"></i></button>
                                    <button class="btn btn-primary">1</button>
                                    <button class="btn btn-outline"><i class="fas fa-chevron-right"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 咨询管理页面 -->
                <div class="page fade-in" id="consultationsPage" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">咨询管理</div>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>用户</th>
                                            <th>咨询标题</th>
                                            <th>状态</th>
                                            <th>创建时间</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>1</td>
                                            <td>张三</td>
                                            <td>关于孕期饮食的咨询</td>
                                            <td><span class="tag tag-success">已回复</span></td>
                                            <td>2023-06-10</td>
                                            <td>
                                                <div class="table-actions">
                                                    <button class="btn btn-outline">
                                                        <i class="fas fa-reply"></i>
                                                    </button>
                                                    <button class="btn btn-danger">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>2</td>
                                            <td>李四</td>
                                            <td>产检时间咨询</td>
                                            <td><span class="tag tag-warning">未回复</span></td>
                                            <td>2023-06-08</td>
                                            <td>
                                                <div class="table-actions">
                                                    <button class="btn btn-outline">
                                                        <i class="fas fa-reply"></i>
                                                    </button>
                                                    <button class="btn btn-danger">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="pagination">
                                <div class="page-info">显示 1 到 2 条记录，共 2 条</div>
                                <div class="page-controls">
                                    <button class="btn btn-outline"><i class="fas fa-chevron-left"></i></button>
                                    <button class="btn btn-primary">1</button>
                                    <button class="btn btn-outline"><i class="fas fa-chevron-right"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 侧边栏切换
        document.getElementById('toggleSidebar').addEventListener('click', function() {
            document.getElementById('sidebar').classList.toggle('collapsed');
        });
        
        // 页面切换
        const menuItems = document.querySelectorAll('.menu-item');
        const pages = document.querySelectorAll('.page');
        const pageTitle = document.getElementById('pageTitle');
        
        menuItems.forEach(item => {
            item.addEventListener('click', function() {
                // 移除所有菜单项的活动状态
                menuItems.forEach(i => i.classList.remove('active'));
                // 添加当前菜单项的活动状态
                this.classList.add('active');
                
                // 隐藏所有页面
                pages.forEach(page => {
                    page.style.display = 'none';
                });
                
                // 显示选中的页面
                const pageId = this.getAttribute('data-page') + 'Page';
                document.getElementById(pageId).style.display = 'block';
                
                // 更新页面标题
                const titles = {
                    'dashboard': '仪表盘',
                    'users': '用户管理',
                    'doctors': '医生管理',
                    'appointments': '预约管理',
                    'knowledge': '知识管理',
                    'consultations': '咨询管理'
                };
                pageTitle.textContent = titles[this.getAttribute('data-page')];
                
                // 如果切换到用户管理页面，则加载用户数据
                if (this.getAttribute('data-page') === 'users') {
                    loadUserList(1);
                }
            });
        });
        
        // 模拟统计数据
        document.getElementById('userCount').textContent = '128';
        document.getElementById('doctorCount').textContent = '15';
        document.getElementById('todayAppointmentCount').textContent = '8';
        document.getElementById('unrepliedCount').textContent = '3';
        
        // 用户管理功能
        let currentPage = 1;
        const pageSize = 10;
        
        // 查询用户列表
        function loadUserList(page = 1, username = '', role = '') {
            currentPage = page;
            const url = `/api/users?page=${page}&size=${pageSize}${role ? '&role=' + role : ''}`;
            
            console.log('正在请求用户列表:', url);
            fetch(url)
                .then(response => {
                    console.log('收到响应:', response);
                    return response.json();
                })
                .then(data => {
                    console.log('解析后的数据:', data);
                    if (data.code === 200) {
                        updateUserTable(data.data.records);
                        updatePagination(data.data);
                    } else {
                        alert('获取用户列表失败: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('获取用户列表失败');
                });
        }
        
        // 更新用户表格
        function updateUserTable(users) {
            const tbody = document.querySelector('#usersPage tbody');
            tbody.innerHTML = '';
            
            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.username}</td>
                    <td>${user.email || ''}</td>
                    <td>${user.realName || ''}</td>
                    <td><span class="tag tag-primary">${getRoleName(user.role)}</span></td>
                    <td><span class="tag ${user.status === 1 ? 'tag-success' : 'tag-danger'}">${user.status === 1 ? '启用' : '禁用'}</span></td>
                    <td>
                        <div class="table-actions">
                            <button class="btn btn-outline view-user" data-id="${user.id}">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-outline edit-user" data-id="${user.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger delete-user" data-id="${user.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // 绑定事件
            bindUserActions();
        }
        
        // 获取角色名称
        function getRoleName(role) {
            const roles = {
                'USER': '普通用户',
                'DOCTOR': '医生',
                'ADMIN': '管理员'
            };
            return roles[role] || role;
        }
        
        // 更新分页信息
        function updatePagination(pageData) {
            const pageInfo = document.querySelector('#usersPage .page-info');
            const pageControls = document.querySelector('#usersPage .page-controls');
            const currentPageNum = document.querySelector('#usersPage #currentUserPageNum');
            const prevPageBtn = document.querySelector('#usersPage #prevUserPage');
            const nextPageBtn = document.querySelector('#usersPage #nextUserPage');
            
            // 计算总页数
            const totalPages = Math.ceil(pageData.total / pageData.pageSize);
            
            // 更新页面信息
            pageInfo.textContent = `显示 ${(pageData.currentPage - 1) * pageData.pageSize + 1} 到 ${Math.min(pageData.currentPage * pageData.pageSize, pageData.total)} 条记录，共 ${pageData.total} 条`;
            
            // 更新当前页码
            currentPageNum.textContent = pageData.currentPage;
            
            // 更新按钮状态
            prevPageBtn.disabled = pageData.currentPage <= 1;
            nextPageBtn.disabled = pageData.currentPage >= totalPages;
        }
        
        // 绑定用户操作事件
        function bindUserActions() {
            // 查看用户
            document.querySelectorAll('.view-user').forEach(btn => {
                btn.addEventListener('click', function() {
                    const userId = this.getAttribute('data-id');
                    viewUser(userId);
                });
            });
            
            // 编辑用户
            document.querySelectorAll('.edit-user').forEach(btn => {
                btn.addEventListener('click', function() {
                    const userId = this.getAttribute('data-id');
                    editUser(userId);
                });
            });
            
            // 删除用户
            document.querySelectorAll('.delete-user').forEach(btn => {
                btn.addEventListener('click', function() {
                    const userId = this.getAttribute('data-id');
                    deleteUser(userId);
                });
            });
        }
        
        // 查看用户详情
        function viewUser(userId) {
            fetch(`/api/users/${userId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200) {
                        const user = data.data;
                        alert(`用户详情:
ID: ${user.id}
用户名: ${user.username}
邮箱: ${user.email || ''}
真实姓名: ${user.realName || ''}
角色: ${getRoleName(user.role)}
状态: ${user.status === 1 ? '启用' : '禁用'}`);
                    } else {
                        alert('获取用户详情失败: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('获取用户详情失败');
                });
        }
        
        // 编辑用户
        function editUser(userId) {
            fetch(`/api/users/${userId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200) {
                        const user = data.data;
                        // 填充表单数据
                        document.getElementById('userId').value = user.id;
                        document.getElementById('username').value = user.username;
                        document.getElementById('password').value = '';
                        document.getElementById('email').value = user.email || '';
                        document.getElementById('realName').value = user.realName || '';
                        document.getElementById('role').value = user.role;
                        document.getElementById('status').value = user.status;
                        
                        // 显示模态框
                        document.getElementById('modalTitle').textContent = '编辑用户';
                        document.getElementById('userModal').style.display = 'block';
                    } else {
                        alert('获取用户信息失败: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('获取用户信息失败');
                });
        }
        
        // 删除用户
        function deleteUser(userId) {
            if (confirm('确定要删除这个用户吗？')) {
                fetch(`/api/users/${userId}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200) {
                        alert('用户删除成功');
                        // 重新加载用户列表
                        loadUserList(currentPage);
                    } else {
                        alert('删除用户失败: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('删除用户失败');
                });
            }
        }
        
        // 为查询按钮添加事件监听器
        const searchButton = document.querySelector('#usersPage .btn-primary i.fa-search').closest('button');
        if (searchButton) {
            searchButton.addEventListener('click', function(e) {
                e.preventDefault();
                // 获取查询条件
                const username = document.querySelector('#usersPage input[placeholder="请输入用户名"]').value;
                const role = document.querySelector('#usersPage select').value;
                
                // 调用后端API查询用户
                loadUserList(1, username, role);
            });
        }
        
        // 添加用户按钮事件
        const addUserButton = document.getElementById('addUserBtn');
        if (addUserButton) {
            addUserButton.addEventListener('click', function() {
                // 清空表单
                document.getElementById('userForm').reset();
                // 特别清空用户ID字段
                document.getElementById('userId').value = '';
                // 设置默认值
                document.getElementById('status').value = '1';
                // 清空密码字段
                document.getElementById('password').value = '';
                // 显示模态框
                document.getElementById('modalTitle').textContent = '添加用户';
                document.getElementById('userModal').style.display = 'block';
            });
        }
        
        // 保存用户
        function saveUser() {
            const userId = document.getElementById('userId').value;
            const user = {
                username: document.getElementById('username').value,
                email: document.getElementById('email').value,
                realName: document.getElementById('realName').value,
                role: document.getElementById('role').value,
                status: parseInt(document.getElementById('status').value)
            };
            
            let url = '/api/users';
            let method = 'POST';
            
            // 如果是更新操作
            if (userId && userId !== '') {
                user.id = parseInt(userId);
                method = 'PUT';
                // 更新时只在需要时发送密码
                const password = document.getElementById('password').value;
                if (password) {
                    user.password = password;
                }
            } else {
                // 新增用户使用注册接口，必须提供密码
                user.password = document.getElementById('password').value;
                url = '/api/users/register';
            }
            
            // 发送请求
            fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(user)
            })
            .then(response => {
                console.log('Response status:', response.status);
                return response.json();
            })
            .then(data => {
                console.log('Response data:', data);
                if (data.code === 200) {
                    alert(userId ? '用户更新成功' : '用户添加成功');
                    closeUserModal();
                    // 重新加载用户列表
                    loadUserList(currentPage);
                } else {
                    const errorMessage = data.message || '未知错误';
                    alert((userId ? '更新' : '添加') + '用户失败: ' + errorMessage);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert((userId ? '更新' : '添加') + '用户失败: ' + (error.message || '网络错误'));
            });
        }
        
        // 关闭模态框
        function closeUserModal() {
            document.getElementById('userModal').style.display = 'none';
            // 清空表单
            document.getElementById('userForm').reset();
            // 特别清空用户ID字段
            document.getElementById('userId').value = '';
            // 清空密码字段
            document.getElementById('password').value = '';
        }
        
        // 绑定模态框事件
        document.getElementById('closeModal').addEventListener('click', closeUserModal);
        document.getElementById('cancelBtn').addEventListener('click', closeUserModal);
        document.getElementById('saveUserBtn').addEventListener('click', saveUser);
        
        // 点击模态框外部关闭
        document.getElementById('userModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeUserModal();
            }
        });
        
        // 当切换到用户管理页面时加载数据
        document.querySelector('[data-page="users"]').addEventListener('click', function() {
            loadUserList(1);
        });
        
        // 页面加载完成后尝试加载用户列表一次
        document.addEventListener('DOMContentLoaded', function() {
            // 如果当前页面是用户管理页面，则加载数据
            if (document.querySelector('[data-page="users"]') && document.querySelector('[data-page="users"]').classList.contains('active')) {
                loadUserList(1);
            }
        });
        
        // 医生管理功能
        let currentDoctorPage = 1;
        const doctorPageSize = 10;
        let currentSearchRealName = ''; // 保存当前搜索的医生姓名
        
        // 查询医生列表
        function loadDoctorList(page = 1, realName = '') {
            currentDoctorPage = page;
            // 如果没有传入realName参数，则使用当前保存的搜索条件
            if (arguments.length === 1) {
                realName = currentSearchRealName;
            } else {
                // 更新当前搜索条件
                currentSearchRealName = realName;
            }
            
            let url = `/api/doctors?page=${page}&size=${doctorPageSize}`;
            if (realName && realName.trim() !== '') {
                url += `&realName=${encodeURIComponent(realName.trim())}`;
            }
            
            console.log('正在请求医生列表:', url);
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    console.log('收到医生列表响应:', data);
                    if (data.code === 200) {
                        updateDoctorTable(data.data.records);
                        updateDoctorPagination(data.data);
                    } else {
                        alert('获取医生列表失败: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('获取医生列表失败');
                });
        }
        
        // 更新医生表格
        function updateDoctorTable(doctors) {
            const tbody = document.querySelector('#doctorsPage tbody');
            tbody.innerHTML = '';
            
            doctors.forEach(doctor => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${doctor.id || ''}</td>
                    <td>${doctor.userId || ''}</td>
                    <td>${doctor.hospital || ''}</td>
                    <td>${doctor.department || ''}</td>
                    <td>${doctor.title || ''}</td>
                    <td>${doctor.specialty || ''}</td>
                    <td>
                        <div class="table-actions">
                            <button class="btn btn-outline view-doctor" data-id="${doctor.id}">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-outline edit-doctor" data-id="${doctor.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger delete-doctor" data-id="${doctor.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // 绑定事件
            bindDoctorActions();
        }
        
        // 更新医生分页信息
        function updateDoctorPagination(pageData) {
            const pageInfo = document.querySelector('#doctorsPage .page-info');
            const pageControls = document.querySelector('#doctorsPage .page-controls');
            const currentPageNum = document.querySelector('#doctorsPage #currentDoctorPageNum');
            const prevPageBtn = document.querySelector('#doctorsPage #prevDoctorPage');
            const nextPageBtn = document.querySelector('#doctorsPage #nextDoctorPage');
            
            // 计算总页数
            const totalPages = Math.ceil(pageData.total / pageData.pageSize);
            
            // 更新页面信息
            pageInfo.textContent = `显示 ${(pageData.currentPage - 1) * pageData.pageSize + 1} 到 ${Math.min(pageData.currentPage * pageData.pageSize, pageData.total)} 条记录，共 ${pageData.total} 条`;
            
            // 更新当前页码
            currentPageNum.textContent = pageData.currentPage;
            
            // 更新按钮状态
            prevPageBtn.disabled = pageData.currentPage <= 1;
            nextPageBtn.disabled = pageData.currentPage >= totalPages;
        }
        
        // 绑定医生操作事件
        function bindDoctorActions() {
            // 查看医生
            document.querySelectorAll('.view-doctor').forEach(btn => {
                btn.addEventListener('click', function() {
                    const doctorId = this.getAttribute('data-id');
                    viewDoctor(doctorId);
                });
            });
            
            // 编辑医生
            document.querySelectorAll('.edit-doctor').forEach(btn => {
                btn.addEventListener('click', function() {
                    const doctorId = this.getAttribute('data-id');
                    editDoctor(doctorId);
                });
            });
            
            // 删除医生
            document.querySelectorAll('.delete-doctor').forEach(btn => {
                btn.addEventListener('click', function() {
                    const doctorId = this.getAttribute('data-id');
                    deleteDoctor(doctorId);
                });
            });
        }
        
        // 查看医生详情
        function viewDoctor(doctorId) {
            fetch(`/api/doctors/${doctorId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200) {
                        const doctor = data.data;
                        alert(`医生详情:
ID: ${doctor.id}
用户ID: ${doctor.userId}
医院: ${doctor.hospital || ''}
科室: ${doctor.department || ''}
职称: ${doctor.title || ''}
专长: ${doctor.specialty || ''}
简介: ${doctor.introduction || ''}`);
                    } else {
                        alert('获取医生详情失败: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('获取医生详情失败');
                });
        }
        
        // 编辑医生
        function editDoctor(doctorId) {
            fetch(`/api/doctors/${doctorId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200) {
                        const doctor = data.data;
                        // 填充表单数据
                        document.getElementById('doctorId').value = doctor.id || '';
                        document.getElementById('doctorUserId').value = doctor.userId || '';
                        document.getElementById('doctorHospital').value = doctor.hospital || '';
                        document.getElementById('doctorDepartment').value = doctor.department || '';
                        document.getElementById('doctorTitle').value = doctor.title || '';
                        document.getElementById('doctorSpecialty').value = doctor.specialty || '';
                        document.getElementById('doctorIntroduction').value = doctor.introduction || '';
                        
                        // 显示模态框
                        document.getElementById('doctorModalTitle').textContent = '编辑医生';
                        document.getElementById('doctorModal').style.display = 'block';
                    } else {
                        alert('获取医生信息失败: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('获取医生信息失败');
                });
        }
        
        // 删除医生
        function deleteDoctor(doctorId) {
            if (confirm('确定要删除这个医生吗？')) {
                fetch(`/api/doctors/${doctorId}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200) {
                        alert('医生删除成功');
                        // 重新加载医生列表
                        loadDoctorList(currentDoctorPage);
                    } else {
                        alert('删除医生失败: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('删除医生失败');
                });
            }
        }
        
        // 保存医生
        function saveDoctor() {
            const doctorId = document.getElementById('doctorId').value;
            const doctor = {
                userId: document.getElementById('doctorUserId').value,
                hospital: document.getElementById('doctorHospital').value,
                department: document.getElementById('doctorDepartment').value,
                title: document.getElementById('doctorTitle').value,
                specialty: document.getElementById('doctorSpecialty').value,
                introduction: document.getElementById('doctorIntroduction').value
            };
            
            let url = '/api/doctors';
            let method = 'POST';
            
            // 如果是更新操作
            if (doctorId && doctorId !== '') {
                doctor.id = parseInt(doctorId);
                method = 'PUT';
            }
            
            // 发送请求
            fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(doctor)
            })
            .then(response => response.json())
            .then(data => {
                if (data.code === 200) {
                    alert(doctorId ? '医生更新成功' : '医生添加成功');
                    closeDoctorModal();
                    // 重新加载医生列表
                    loadDoctorList(currentDoctorPage);
                } else {
                    alert((doctorId ? '更新' : '添加') + '医生失败: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert((doctorId ? '更新' : '添加') + '医生失败: ' + (error.message || '网络错误'));
            });
        }
        
        // 关闭医生模态框
        function closeDoctorModal() {
            document.getElementById('doctorModal').style.display = 'none';
            // 清空表单
            document.getElementById('doctorForm').reset();
            // 特别清空医生ID字段
            document.getElementById('doctorId').value = '';
        }
        
        // 添加医生按钮事件
        document.getElementById('addDoctorBtn').addEventListener('click', function() {
            // 清空表单
            document.getElementById('doctorForm').reset();
            // 特别清空医生ID字段
            document.getElementById('doctorId').value = '';
            // 显示模态框
            document.getElementById('doctorModalTitle').textContent = '添加医生';
            document.getElementById('doctorModal').style.display = 'block';
        });
        
        // 绑定医生模态框事件
        document.getElementById('closeDoctorModal').addEventListener('click', closeDoctorModal);
        document.getElementById('cancelDoctorBtn').addEventListener('click', closeDoctorModal);
        document.getElementById('saveDoctorBtn').addEventListener('click', saveDoctor);
        
        // 点击医生模态框外部关闭
        document.getElementById('doctorModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeDoctorModal();
            }
        });
        
        // 当切换到医生管理页面时加载数据
        document.querySelector('[data-page="doctors"]').addEventListener('click', function() {
            // 清空搜索条件
            document.getElementById('doctorRealName').value = '';
            currentSearchRealName = '';
            loadDoctorList(1);
        });
        
        // 绑定医生查询按钮事件
        document.getElementById('searchDoctorBtn').addEventListener('click', function() {
            const realName = document.getElementById('doctorRealName').value;
            loadDoctorList(1, realName);
        });
        
        // 绑定医生重置按钮事件
        document.getElementById('resetDoctorBtn').addEventListener('click', function() {
            document.getElementById('doctorRealName').value = '';
            currentSearchRealName = '';
            loadDoctorList(1);
        });
        
        // 绑定医生查询表单回车事件
        document.getElementById('doctorRealName').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const realName = this.value;
                loadDoctorList(1, realName);
            }
        });

    </script>
</body>
</html>