<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>孕妇健康管理系统 - 管理后台</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="./css/admin.css">
    <style>
        /* 图表容器样式 */
        .chart-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .chart-card {
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        
        .chart-header {
            margin-bottom: 15px;
        }
        
        .chart-header h3 {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
            color: #303133;
        }
        
        .chart-body {
            height: 300px;
            position: relative;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .chart-container {
                grid-template-columns: 1fr;
            }
            
            .chart-body {
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- 侧边栏 -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-baby"></i>
                    </div>
                    <div class="logo-text">孕妇健康管理系统</div>
                </div>
                <button class="toggle-btn" id="toggleSidebar">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            
            <div class="sidebar-menu">
                <div class="menu-item active" data-page="dashboard">
                    <i class="fas fa-home"></i>
                    <span>仪表盘</span>
                </div>
                <!-- 管理员菜单项 -->
                <div class="menu-item admin-only" data-page="users">
                    <i class="fas fa-users"></i>
                    <span>用户管理</span>
                </div>
                <div class="menu-item" data-page="doctors">
                    <i class="fas fa-user-md"></i>
                    <span>医生管理</span>
                </div>
                <div class="menu-item" data-page="appointments">
                    <i class="fas fa-calendar-check"></i>
                    <span>预约管理</span>
                </div>
                <div class="menu-item" data-page="knowledge">
                    <i class="fas fa-book-medical"></i>
                    <span>知识管理</span>
                </div>
                <div class="menu-item" data-page="consultations">
                    <i class="fas fa-comments"></i>
                    <span>咨询管理</span>
                </div>
            </div>
        </div>
        
        <!-- 主内容区 -->
        <div class="main-content">
            <!-- 顶部导航栏 -->
            <div class="header">
                <div class="header-left">
                    <h1 id="pageTitle">仪表盘</h1>
                </div>
                <div class="header-right">
                    <div class="user-profile" id="userProfile">
                        <div class="user-avatar" id="userAvatar">管</div>
                        <div class="user-name" id="userName">管理员</div>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="logout-btn" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i> 退出
                    </div>
                </div>
            </div>
            
            <!-- 内容区域 -->
            <div class="content" id="contentArea">
                <!-- 内容将通过Ajax动态加载 -->
                
                <!-- 用户编辑模态框 -->
                <div class="modal" id="userModal" style="display: none;">
                    <div class="modal-dialog">
                        <div class="modal-header">
                            <h3 id="modalTitle">编辑用户</h3>
                            <button class="btn btn-outline" id="closeModal">&times;</button>
                        </div>
                        <div class="modal-body">
                            <form id="userForm">
                                <input type="hidden" id="userId">
                                <div class="form-group">
                                    <label>用户名</label>
                                    <input type="text" class="form-control" id="username" required>
                                </div>
                                <div class="form-group">
                                    <label>密码</label>
                                    <input type="password" class="form-control" id="password" required>
                                </div>
                                <div class="form-group">
                                    <label>邮箱</label>
                                    <input type="email" class="form-control" id="email">
                                </div>
                                <div class="form-group">
                                    <label>真实姓名</label>
                                    <input type="text" class="form-control" id="realName">
                                </div>
                                <div class="form-group">
                                    <label>角色</label>
                                    <select class="form-control" id="role">
                                        <option value="USER">普通用户</option>
                                        <option value="DOCTOR">医生</option>
                                        <option value="ADMIN">管理员</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>状态</label>
                                    <select class="form-control" id="status">
                                        <option value="1">启用</option>
                                        <option value="0">禁用</option>
                                    </select>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline" id="cancelBtn">取消</button>
                            <button class="btn btn-primary" id="saveUserBtn">保存</button>
                        </div>
                    </div>
                </div>
                
                <!-- 用户管理页面 -->
                <div class="page fade-in" id="usersPage" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">用户管理</div>
                            <button class="btn btn-primary" id="addUserBtn">
                                <i class="fas fa-plus"></i> 添加用户
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>用户名</label>
                                    <input type="text" class="form-control" placeholder="请输入用户名">
                                </div>
                                <div class="form-group">
                                    <label>角色</label>
                                    <select class="form-control">
                                        <option value="">全部</option>
                                        <option value="USER">普通用户</option>
                                        <option value="DOCTOR">医生</option>
                                        <option value="ADMIN">管理员</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>&nbsp;</label>
                                    <button class="btn btn-primary">
                                        <i class="fas fa-search"></i> 查询
                                    </button>
                                </div>
                            </div>
                            
                            <div class="table-container">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>用户名</th>
                                            <th>邮箱</th>
                                            <th>真实姓名</th>
                                            <th>角色</th>
                                            <th>状态</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- 动态生成用户列表 -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="pagination">
                                <div class="page-info">显示 0 到 0 条记录，共 0 条</div>
                                <div class="page-controls">
                                    <button class="btn btn-outline" id="prevUserPage"><i class="fas fa-chevron-left"></i></button>
                                    <button class="btn btn-primary" id="currentUserPageNum">1</button>
                                    <button class="btn btn-outline" id="nextUserPage"><i class="fas fa-chevron-right"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 医生编辑模态框 -->
                <div class="modal" id="doctorModal" style="display: none;">
                    <div class="modal-dialog">
                        <div class="modal-header">
                            <h3 id="doctorModalTitle">编辑医生</h3>
                            <button class="btn btn-outline" id="closeDoctorModal">&times;</button>
                        </div>
                        <div class="modal-body">
                            <form id="doctorForm">
                                <input type="hidden" id="doctorId">
                                <div class="form-group">
                                    <label>用户ID</label>
                                    <input type="number" class="form-control" id="doctorUserId" required>
                                </div>
                                <div class="form-group">
                                    <label>医院</label>
                                    <input type="text" class="form-control" id="doctorHospital" required>
                                </div>
                                <div class="form-group">
                                    <label>科室</label>
                                    <input type="text" class="form-control" id="doctorDepartment" required>
                                </div>
                                <div class="form-group">
                                    <label>职称</label>
                                    <input type="text" class="form-control" id="doctorTitle" required>
                                </div>
                                <div class="form-group">
                                    <label>专长</label>
                                    <input type="text" class="form-control" id="doctorSpecialty">
                                </div>
                                <div class="form-group">
                                    <label>简介</label>
                                    <textarea class="form-control" id="doctorIntroduction" rows="3"></textarea>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-outline" id="cancelDoctorBtn">取消</button>
                            <button class="btn btn-primary" id="saveDoctorBtn">保存</button>
                        </div>
                    </div>
                </div>
                
                <!-- 医生管理页面 -->
                <div class="page fade-in" id="doctorsPage" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">医生管理</div>
                            <button class="btn btn-primary" id="addDoctorBtn">
                                <i class="fas fa-plus"></i> 添加医生
                            </button>
                        </div>
                        <div class="card-body">
                            <!-- 添加查询表单 -->
                            <div class="form-row">
                                <div class="form-group">
                                    <label>医生姓名</label>
                                    <input type="text" class="form-control" id="doctorRealName" placeholder="请输入医生姓名">
                                </div>
                                <div class="form-group">
                                    <label>&nbsp;</label>
                                    <button class="btn btn-primary" id="searchDoctorBtn">
                                        <i class="fas fa-search"></i> 查询
                                    </button>
                                    <button class="btn btn-outline" id="resetDoctorBtn">
                                        <i class="fas fa-refresh"></i> 重置
                                    </button>
                                </div>
                            </div>
                            
                            <div class="table-container">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>用户ID</th>
                                            <th>医院</th>
                                            <th>科室</th>
                                            <th>职称</th>
                                            <th>专长</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- 动态生成医生列表 -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="pagination">
                                <div class="page-info">显示 0 到 0 条记录，共 0 条</div>
                                <div class="page-controls">
                                    <button class="btn btn-outline" onclick="loadDoctorList(currentDoctorPage - 1)" id="prevDoctorPage"><i class="fas fa-chevron-left"></i></button>
                                    <button class="btn btn-primary" id="currentDoctorPageNum">1</button>
                                    <button class="btn btn-outline" onclick="loadDoctorList(currentDoctorPage + 1)" id="nextDoctorPage"><i class="fas fa-chevron-right"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 预约管理页面 -->
                <div class="page fade-in" id="appointmentsPage" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">预约管理</div>
                        </div>
                        <div class="card-body">
                            <!-- 添加查询表单 -->
                            <div class="form-row">
                                <div class="form-group">
                                    <label>用户姓名</label>
                                    <input type="text" class="form-control" id="appointmentUserRealName" placeholder="请输入用户姓名">
                                </div>
                                <div class="form-group">
                                    <label>&nbsp;</label>
                                    <button class="btn btn-primary" id="searchAppointmentBtn">
                                        <i class="fas fa-search"></i> 查询
                                    </button>
                                    <button class="btn btn-outline" id="resetAppointmentBtn">
                                        <i class="fas fa-refresh"></i> 重置
                                    </button>
                                </div>
                            </div>
                            
                            <div class="table-container">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>用户</th>
                                            <th>医院</th>
                                            <th>科室</th>
                                            <th>医生职称</th>
                                            <th>预约时间</th>
                                            <th>状态</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- 动态生成预约列表 -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="pagination">
                                <div class="page-info">显示 0 到 0 条记录，共 0 条</div>
                                <div class="page-controls">
                                    <button class="btn btn-outline" onclick="loadAppointmentList(currentAppointmentPage - 1)" id="prevAppointmentPage"><i class="fas fa-chevron-left"></i></button>
                                    <button class="btn btn-primary" id="currentAppointmentPageNum">1</button>
                                    <button class="btn btn-outline" onclick="loadAppointmentList(currentAppointmentPage + 1)" id="nextAppointmentPage"><i class="fas fa-chevron-right"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 知识管理页面 -->
                <div class="page fade-in" id="knowledgePage" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">知识管理</div>
                            <button class="btn btn-primary" id="addKnowledgeBtn">
                                <i class="fas fa-plus"></i> 添加知识
                            </button>
                        </div>
                        <div class="card-body">
                            <!-- 添加查询表单 -->
                            <div class="form-row">
                                <div class="form-group">
                                    <label>标题</label>
                                    <input type="text" class="form-control" id="knowledgeTitle" placeholder="请输入标题">
                                </div>
                                <div class="form-group">
                                    <label>&nbsp;</label>
                                    <button class="btn btn-primary" id="searchKnowledgeBtn">
                                        <i class="fas fa-search"></i> 查询
                                    </button>
                                    <button class="btn btn-outline" id="resetKnowledgeBtn">
                                        <i class="fas fa-refresh"></i> 重置
                                    </button>
                                </div>
                            </div>
                            
                            <div class="table-container">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>标题</th>
                                            <th>分类</th>
                                            <th>状态</th>
                                            <th>创建时间</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- 动态生成知识列表 -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="pagination">
                                <div class="page-info">显示 0 到 0 条记录，共 0 条</div>
                                <div class="page-controls">
                                    <button class="btn btn-outline" onclick="loadKnowledgeList(currentKnowledgePage - 1)" id="prevKnowledgePage"><i class="fas fa-chevron-left"></i></button>
                                    <button class="btn btn-primary" id="currentKnowledgePageNum">1</button>
                                    <button class="btn btn-outline" onclick="loadKnowledgeList(currentKnowledgePage + 1)" id="nextKnowledgePage"><i class="fas fa-chevron-right"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 咨询管理页面 -->
                <div class="page fade-in" id="consultationsPage" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">咨询管理</div>
                            <button class="btn btn-primary" id="addConsultationBtn">
                                <i class="fas fa-plus"></i> 添加咨询
                            </button>
                        </div>
                        <div class="card-body">
                            <!-- 添加查询表单 -->
                            <div class="form-row">
                                <div class="form-group">
                                    <label>标题</label>
                                    <input type="text" class="form-control" id="consultationTitle" placeholder="请输入标题">
                                </div>
                                <div class="form-group">
                                    <label>状态</label>
                                    <select class="form-control" id="consultationStatus">
                                        <option value="">全部</option>
                                        <option value="0">未回复</option>
                                        <option value="1">已回复</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>&nbsp;</label>
                                    <button class="btn btn-primary" id="searchConsultationBtn">
                                        <i class="fas fa-search"></i> 查询
                                    </button>
                                    <button class="btn btn-outline" id="resetConsultationBtn">
                                        <i class="fas fa-refresh"></i> 重置
                                    </button>
                                </div>
                            </div>
                            
                            <div class="table-container">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>用户</th>
                                            <th>医生</th>
                                            <th>标题</th>
                                            <th>状态</th>
                                            <th>创建时间</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- 动态生成咨询列表 -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="pagination">
                                <div class="page-info">显示 0 到 0 条记录，共 0 条</div>
                                <div class="page-controls">
                                    <button class="btn btn-outline" onclick="loadConsultationList(currentConsultationPage - 1)" id="prevConsultationPage"><i class="fas fa-chevron-left"></i></button>
                                    <button class="btn btn-primary" id="currentConsultationPageNum">1</button>
                                    <button class="btn btn-outline" onclick="loadConsultationList(currentConsultationPage + 1)" id="nextConsultationPage"><i class="fas fa-chevron-right"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // 全局变量存储当前用户信息
        let currentUser = null;
        let appointmentChart = null;
        let patientChart = null;
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 从localStorage获取当前用户信息
            const userStr = localStorage.getItem('currentUser');
            if (userStr) {
                currentUser = JSON.parse(userStr);
                // 更新页面显示的用户信息
                document.getElementById('userName').textContent = currentUser.realName || currentUser.username;
                
                // 根据角色设置头像和显示文本
                if (currentUser.role === 'ADMIN') {
                    document.getElementById('userAvatar').textContent = '管';
                    document.getElementById('userName').textContent = currentUser.realName || currentUser.username || '管理员';
                } else if (currentUser.role === 'DOCTOR') {
                    document.getElementById('userAvatar').textContent = '医';
                    document.getElementById('userName').textContent = currentUser.realName || currentUser.username || '医生';
                    // 医生登录后隐藏用户管理菜单
                    const userMenuItem = document.querySelector('[data-page="users"]');
                    if (userMenuItem) {
                        userMenuItem.style.display = 'none';
                    }
                }
                
                // 根据角色调整界面显示
                adjustUIByRole(currentUser.role);
                
                // 默认显示仪表盘页面
                document.getElementById('dashboardPage').style.display = 'block';
                document.querySelector('[data-page="dashboard"]').classList.add('active');
                
                // 加载仪表盘数据
                loadDashboardData();
            } else {
                // 如果没有用户信息，跳转到登录页面
                window.location.href = './admin-login.html';
            }
            
            // 绑定退出按钮事件
            document.getElementById('logoutBtn').addEventListener('click', function() {
                // 清除用户信息
                localStorage.removeItem('currentUser');
                
                // 调用后端接口清除session
                fetch('/api/users/clear-session', {
                    method: 'POST'
                }).then(() => {
                    // 跳转到登录页面
                    window.location.href = './admin-login.html';
                }).catch(error => {
                    console.error('清除session失败:', error);
                    // 即使失败也跳转到登录页面
                    window.location.href = './admin-login.html';
                });
            });
        });
        
        // 加载仪表盘数据
        function loadDashboardData() {
            // 获取统计数据
            fetch('/api/dashboard/statistics')
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200) {
                        // 更新统计数据
                        document.getElementById('userCount').textContent = data.data.userCount || 0;
                        document.getElementById('doctorCount').textContent = data.data.doctorCount || 0;
                        document.getElementById('todayAppointmentCount').textContent = data.data.todayAppointmentCount || 0;
                        document.getElementById('unrepliedCount').textContent = data.data.unrepliedCount || 0;
                    }
                })
                .catch(error => {
                    console.error('获取统计数据失败:', error);
                });
            
            // 获取预约趋势数据
            fetch('/api/dashboard/appointment-trend')
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200) {
                        // 创建预约趋势图表
                        createAppointmentChart(data.data);
                    }
                })
                .catch(error => {
                    console.error('获取预约趋势数据失败:', error);
                });
            
            // 获取病人数量数据
            fetch('/api/dashboard/patient-stats')
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200) {
                        // 创建病人数量图表
                        createPatientChart(data.data);
                    }
                })
                .catch(error => {
                    console.error('获取病人数量数据失败:', error);
                });
        }
        
        // 创建预约趋势图表
        function createAppointmentChart(data) {
            const ctx = document.getElementById('appointmentChart').getContext('2d');
            
            // 如果图表已存在，先销毁
            if (appointmentChart) {
                appointmentChart.destroy();
            }
            
            // 准备图表数据
            const labels = data.map(item => item.date);
            const values = data.map(item => item.count);
            
            appointmentChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '预约数量',
                        data: values,
                        borderColor: '#409EFF',
                        backgroundColor: 'rgba(64, 158, 255, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }
        
        // 创建病人数量图表
        function createPatientChart(data) {
            const ctx = document.getElementById('patientChart').getContext('2d');
            
            // 如果图表已存在，先销毁
            if (patientChart) {
                patientChart.destroy();
            }
            
            // 准备图表数据
            const labels = data.map(item => item.date);
            const values = data.map(item => item.count);
            
            patientChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '病人数量',
                        data: values,
                        backgroundColor: '#67C23A',
                        borderColor: '#67C23A',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }
        
        // 根据用户角色调整界面显示
        function adjustUIByRole(role) {
            // 隐藏所有仅管理员可见的元素
            const adminOnlyElements = document.querySelectorAll('.admin-only');
            adminOnlyElements.forEach(element => {
                element.style.display = 'none';
            });
            
            // 根据角色显示相应内容
            if (role === 'ADMIN') {
                // 管理员可以看到所有菜单
                adminOnlyElements.forEach(element => {
                    element.style.display = 'flex';
                });
            } else if (role === 'DOCTOR') {
                // 医生只能看到部分菜单
                // 仪表盘、医生管理（仅自己）、预约管理（仅自己的）、知识管理（全部）、咨询管理（仅自己的）
                document.querySelector('[data-page="dashboard"]').style.display = 'flex';
                document.querySelector('[data-page="doctors"]').style.display = 'flex';
                document.querySelector('[data-page="appointments"]').style.display = 'flex';
                document.querySelector('[data-page="knowledge"]').style.display = 'flex';
                document.querySelector('[data-page="consultations"]').style.display = 'flex';
                
                // 隐藏用户管理菜单项
                const userMenuItem = document.querySelector('[data-page="users"]');
                if (userMenuItem) {
                    userMenuItem.style.display = 'none';
                }
                
                // 隐藏用户管理页面中的添加按钮和某些操作按钮
                const addUserBtn = document.getElementById('addUserBtn');
                if (addUserBtn) {
                    addUserBtn.style.display = 'none';
                }
                
                // 在医生管理页面中，隐藏添加医生按钮和删除按钮
                const addDoctorBtn = document.getElementById('addDoctorBtn');
                if (addDoctorBtn) {
                    // 医生不能添加医生
                    if (role === 'DOCTOR') {
                        addDoctorBtn.style.display = 'none';
                    }
                }
                
                // 隐藏医生管理页面中的删除按钮
                if (role === 'DOCTOR') {
                    const deleteDoctorButtons = document.querySelectorAll('.delete-doctor');
                    deleteDoctorButtons.forEach(button => {
                        button.style.display = 'none';
                    });
                }
            }
        }
        
        // 当切换到医生管理页面时加载数据
        document.querySelector('[data-page="doctors"]').addEventListener('click', function() {
            loadDoctorList(1);
            
            // 如果是医生登录，隐藏添加医生按钮
            if (currentUser && currentUser.role === 'DOCTOR') {
                const addDoctorBtn = document.getElementById('addDoctorBtn');
                if (addDoctorBtn) {
                    addDoctorBtn.style.display = 'none';
                }
            } else {
                // 管理员登录，显示添加医生按钮
                const addDoctorBtn = document.getElementById('addDoctorBtn');
                if (addDoctorBtn) {
                    addDoctorBtn.style.display = 'block';
                }
            }
        });
        
        // 绑定添加医生按钮事件
        document.getElementById('addDoctorBtn').addEventListener('click', function() {
            // 清空表单
            document.getElementById('doctorForm').reset();
            document.getElementById('doctorId').value = '';
            // 显示模态框
            document.getElementById('doctorModal').style.display = 'block';
        });
        
        // 预约管理功能
        document.querySelector('[data-page="appointments"]').addEventListener('click', function() {
            loadAppointmentList(1);
        });

        // 侧边栏切换
        document.getElementById('toggleSidebar').addEventListener('click', function() {
            document.getElementById('sidebar').classList.toggle('collapsed');
        });
        
        // 页面切换
        const menuItems = document.querySelectorAll('.menu-item');
        const pages = document.querySelectorAll('.page');
        const pageTitle = document.getElementById('pageTitle');
        
        menuItems.forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                
                // 隐藏所有页面
                pages.forEach(page => {
                    page.style.display = 'none';
                });
                
                // 移除所有菜单项的激活状态
                menuItems.forEach(menuItem => {
                    menuItem.classList.remove('active');
                });
                
                // 添加当前菜单项的激活状态
                this.classList.add('active');
                
                // 显示对应的页面
                const pageId = this.getAttribute('data-page');
                document.getElementById(`${pageId}Page`).style.display = 'block';
                
                // 根据用户角色调整界面显示
                if (currentUser && currentUser.role === 'DOCTOR') {
                    // 医生只能看到部分菜单
                    if (pageId === 'users') {
                        alert('您没有权限访问此页面');
                        // 返回到仪表盘页面
                        document.getElementById('dashboardPage').style.display = 'block';
                        document.querySelector('[data-page="dashboard"]').classList.add('active');
                        this.classList.remove('active');
                        return;
                    }
                } else if (currentUser && currentUser.role === 'ADMIN') {
                    // 管理员可以看到所有菜单
                    document.querySelector('[data-page="dashboard"]').style.display = 'flex';
                    document.querySelector('[data-page="users"]').style.display = 'flex';
                    document.querySelector('[data-page="doctors"]').style.display = 'flex';
                    document.querySelector('[data-page="appointments"]').style.display = 'flex';
                    document.querySelector('[data-page="knowledge"]').style.display = 'flex';
                    document.querySelector('[data-page="consultations"]').style.display = 'flex';
                }
                
                // 更新页面标题
                const titles = {
                    'dashboard': '仪表盘',
                    'users': '用户管理',
                    'doctors': '医生管理',
                    'appointments': '预约管理',
                    'knowledge': '知识管理',
                    'consultations': '咨询管理'
                };
                pageTitle.textContent = titles[pageId];
                
                // 根据页面加载相应数据
                switch(pageId) {
                    case 'dashboard':
                        loadDashboardData();
                        break;
                    case 'users':
                        loadUserList(1);
                        break;
                    case 'doctors':
                        loadDoctorList(1);
                        break;
                    case 'appointments':
                        loadAppointmentList(1);
                        break;
                    case 'knowledge':
                        loadKnowledgeList(1);
                        break;
                    case 'consultations':
                        loadConsultationList(1);
                        break;
                }
            });
        });
        
        // 模拟统计数据
        document.getElementById('userCount').textContent = '128';
        document.getElementById('doctorCount').textContent = '15';
        document.getElementById('todayAppointmentCount').textContent = '8';
        document.getElementById('unrepliedCount').textContent = '3';
        
        // 用户管理功能
        let currentPage = 1;
        const pageSize = 10;
        
        // 查询用户列表
        function loadUserList(page = 1, username = '', role = '') {
            // 管理员才能访问用户管理
            if (currentUser && currentUser.role !== 'ADMIN') {
                alert('您没有权限访问此功能');
                return;
            }
            
            currentPage = page;
            const url = `/api/users?page=${page}&size=${pageSize}${role ? '&role=' + role : ''}`;
            
            console.log('正在请求用户列表:', url);
            fetch(url)
                .then(response => {
                    console.log('收到响应:', response);
                    return response.json();
                })
                .then(data => {
                    console.log('解析后的数据:', data);
                    if (data.code === 200) {
                        updateUserTable(data.data.records);
                        updatePagination(data.data);
                    } else {
                        alert('获取用户列表失败: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('获取用户列表失败');
                });
        }
        
        // 更新用户表格
        function updateUserTable(users) {
            const tbody = document.querySelector('#usersPage tbody');
            tbody.innerHTML = '';
            
            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.username}</td>
                    <td>${user.email || ''}</td>
                    <td>${user.realName || ''}</td>
                    <td><span class="tag tag-primary">${getRoleName(user.role)}</span></td>
                    <td><span class="tag ${user.status === 1 ? 'tag-success' : 'tag-danger'}">${user.status === 1 ? '启用' : '禁用'}</span></td>
                    <td>
                        <div class="table-actions">
                            <button class="btn btn-outline view-user" data-id="${user.id}">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-outline edit-user" data-id="${user.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger delete-user" data-id="${user.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // 绑定事件
            bindUserActions();
        }
        
        // 获取角色名称
        function getRoleName(role) {
            const roles = {
                'USER': '普通用户',
                'DOCTOR': '医生',
                'ADMIN': '管理员'
            };
            return roles[role] || role;
        }
        
        // 更新分页信息
        function updatePagination(pageData) {
            const pageInfo = document.querySelector('#usersPage .page-info');
            const pageControls = document.querySelector('#usersPage .page-controls');
            const currentPageNum = document.querySelector('#usersPage #currentUserPageNum');
            const prevPageBtn = document.querySelector('#usersPage #prevUserPage');
            const nextPageBtn = document.querySelector('#usersPage #nextUserPage');
            
            // 计算总页数
            const totalPages = Math.ceil(pageData.total / pageData.pageSize);
            
            // 更新页面信息
            pageInfo.textContent = `显示 ${(pageData.currentPage - 1) * pageData.pageSize + 1} 到 ${Math.min(pageData.currentPage * pageData.pageSize, pageData.total)} 条记录，共 ${pageData.total} 条`;
            
            // 更新当前页码
            currentPageNum.textContent = pageData.currentPage;
            
            // 更新按钮状态
            prevPageBtn.disabled = pageData.currentPage <= 1;
            nextPageBtn.disabled = pageData.currentPage >= totalPages;
        }
        
        // 绑定用户操作事件
        function bindUserActions() {
            // 查看用户
            document.querySelectorAll('.view-user').forEach(btn => {
                btn.addEventListener('click', function() {
                    const userId = this.getAttribute('data-id');
                    viewUser(userId);
                });
            });
            
            // 编辑用户
            document.querySelectorAll('.edit-user').forEach(btn => {
                btn.addEventListener('click', function() {
                    const userId = this.getAttribute('data-id');
                    editUser(userId);
                });
            });
            
            // 删除用户
            document.querySelectorAll('.delete-user').forEach(btn => {
                btn.addEventListener('click', function() {
                    const userId = this.getAttribute('data-id');
                    deleteUser(userId);
                });
            });
        }
        
        // 查看用户详情
        function viewUser(userId) {
            // 管理员才能查看用户详情
            if (currentUser && currentUser.role !== 'ADMIN') {
                alert('您没有权限访问此功能');
                return;
            }
            
            fetch(`/api/users/${userId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200) {
                        const user = data.data;
                        alert(`用户详情:
ID: ${user.id}
用户名: ${user.username}
邮箱: ${user.email || ''}
真实姓名: ${user.realName || ''}
角色: ${getRoleName(user.role)}
状态: ${user.status === 1 ? '启用' : '禁用'}`);
                    } else {
                        alert('获取用户详情失败: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('获取用户详情失败');
                });
        }
        
        // 编辑用户
        function editUser(userId) {
            // 管理员才能编辑用户
            if (currentUser && currentUser.role !== 'ADMIN') {
                alert('您没有权限访问此功能');
                return;
            }
            
            fetch(`/api/users/${userId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200) {
                        const user = data.data;
                        // 填充表单数据
                        document.getElementById('userId').value = user.id;
                        document.getElementById('username').value = user.username;
                        document.getElementById('password').value = '';
                        document.getElementById('email').value = user.email || '';
                        document.getElementById('realName').value = user.realName || '';
                        document.getElementById('role').value = user.role;
                        document.getElementById('status').value = user.status;
                        
                        // 显示模态框
                        document.getElementById('modalTitle').textContent = '编辑用户';
                        document.getElementById('userModal').style.display = 'block';
                    } else {
                        alert('获取用户信息失败: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('获取用户信息失败');
                });
        }
        
        // 删除医生
        // 删除医生
        function deleteDoctor(doctorId) {
            // 如果是医生登录，不能删除医生（医生不能删除任何医生信息）
            if (currentUser && currentUser.role === 'DOCTOR') {
                alert('您没有权限删除医生信息');
                return;
            }
            
            if (confirm('确定要删除这个医生吗？')) {
                fetch(`/api/doctors/${doctorId}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200) {
                        alert('医生删除成功');
                        // 重新加载医生列表
                        loadDoctorList(currentDoctorPage);
                    } else {
                        alert('删除医生失败: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('删除医生失败');
                });
            }
        }
        
        // 删除用户
        function deleteUser(userId) {
            // 管理员才能删除用户
            if (currentUser && currentUser.role !== 'ADMIN') {
                alert('您没有权限访问此功能');
                return;
            }
            
            if (confirm('确定要删除这个用户吗？')) {
                fetch(`/api/users/${userId}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200) {
                        alert('用户删除成功');
                        // 重新加载用户列表
                        loadUserList(currentPage);
                    } else {
                        alert('删除用户失败: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('删除用户失败');
                });
            }
        }
        
        // 为查询按钮添加事件监听器
        const searchButton = document.querySelector('#usersPage .btn-primary i.fa-search').closest('button');
        if (searchButton) {
            searchButton.addEventListener('click', function(e) {
                e.preventDefault();
                // 获取查询条件
                const username = document.querySelector('#usersPage input[placeholder="请输入用户名"]').value;
                const role = document.querySelector('#usersPage select').value;
                
                // 调用后端API查询用户
                loadUserList(1, username, role);
            });
        }
        
        // 添加用户按钮事件
        const addUserButton = document.getElementById('addUserBtn');
        if (addUserButton) {
            addUserButton.addEventListener('click', function() {
                // 管理员才能添加用户
                if (currentUser && currentUser.role !== 'ADMIN') {
                    alert('您没有权限访问此功能');
                    return;
                }
                
                // 清空表单
                document.getElementById('userForm').reset();
                // 特别清空用户ID字段
                document.getElementById('userId').value = '';
                // 设置默认值
                document.getElementById('status').value = '1';
                // 清空密码字段
                document.getElementById('password').value = '';
                // 显示模态框
                document.getElementById('modalTitle').textContent = '添加用户';
                document.getElementById('userModal').style.display = 'block';
            });
        }
        
        // 绑定添加医生按钮事件
        document.getElementById('addDoctorBtn').addEventListener('click', function() {
            // 如果是医生登录，不能添加医生
            if (currentUser && currentUser.role === 'DOCTOR') {
                alert('您没有权限添加医生');
                return;
            }
            
            // 清空表单
            document.getElementById('doctorForm').reset();
            document.getElementById('doctorId').value = '';
            // 显示模态框
            document.getElementById('doctorModal').style.display = 'block';
        });
        
        // 保存用户
        function saveUser() {
            // 管理员才能保存用户
            if (currentUser && currentUser.role !== 'ADMIN') {
                alert('您没有权限访问此功能');
                return;
            }
            
            const userId = document.getElementById('userId').value;
            const user = {
                username: document.getElementById('username').value,
                email: document.getElementById('email').value,
                realName: document.getElementById('realName').value,
                role: document.getElementById('role').value,
                status: parseInt(document.getElementById('status').value)
            };
            
            let url = '/api/users';
            let method = 'POST';
            
            // 如果是更新操作
            if (userId && userId !== '') {
                user.id = parseInt(userId);
                method = 'PUT';
                // 更新时只在需要时发送密码
                const password = document.getElementById('password').value;
                if (password) {
                    user.password = password;
                }
            } else {
                // 新增用户使用注册接口，必须提供密码
                user.password = document.getElementById('password').value;
                url = '/api/users/register';
            }
            
            // 发送请求
            fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(user)
            })
            .then(response => {
                console.log('Response status:', response.status);
                return response.json();
            })
            .then(data => {
                console.log('Response data:', data);
                if (data.code === 200) {
                    alert(userId ? '用户更新成功' : '用户添加成功');
                    closeUserModal();
                    // 重新加载用户列表
                    loadUserList(currentPage);
                } else {
                    const errorMessage = data.message || '未知错误';
                    alert((userId ? '更新' : '添加') + '用户失败: ' + errorMessage);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert((userId ? '更新' : '添加') + '用户失败: ' + (error.message || '网络错误'));
            });
        }
        
        // 关闭模态框
        function closeUserModal() {
            document.getElementById('userModal').style.display = 'none';
            // 清空表单
            document.getElementById('userForm').reset();
            // 特别清空用户ID字段
            document.getElementById('userId').value = '';
            // 清空密码字段
            document.getElementById('password').value = '';
        }
        
        // 绑定模态框事件
        document.getElementById('closeModal').addEventListener('click', closeUserModal);
        document.getElementById('cancelBtn').addEventListener('click', closeUserModal);
        document.getElementById('saveUserBtn').addEventListener('click', saveUser);
        
        // 点击模态框外部关闭
        document.getElementById('userModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeUserModal();
            }
        });
        
        // 当切换到用户管理页面时加载数据
        document.querySelector('[data-page="users"]').addEventListener('click', function() {
            // 管理员才能访问用户管理
            if (currentUser && currentUser.role !== 'ADMIN') {
                alert('您没有权限访问此功能');
                return;
            }
            loadUserList(1);
        });
        
        // 医生管理功能
        let currentDoctorPage = 1;
        const doctorPageSize = 10;
        let currentSearchRealName = ''; // 保存当前搜索的医生姓名
        
        // 查询医生列表
        function loadDoctorList(page = 1, realName = '') {
            // 如果是医生登录，只能查看自己的信息
            if (currentUser && currentUser.role === 'DOCTOR') {
                // 直接获取当前医生的信息
                fetch(`/api/doctors/user/${currentUser.id}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.code === 200) {
                            // 将单个医生对象转换为数组格式以适应现有表格更新函数
                            updateDoctorTable([data.data]);
                            // 更新分页信息（医生只能看到自己，所以只有1页）
                            const fakePageData = {
                                currentPage: 1,
                                pageSize: 1,
                                total: 1
                            };
                            updateDoctorPagination(fakePageData);
                        } else {
                            alert('获取医生信息失败: ' + data.message);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('获取医生信息失败');
                    });
                return;
            }
            
            currentDoctorPage = page;
            // 如果没有传入realName参数，则使用当前保存的搜索条件
            if (arguments.length === 1) {
                realName = currentSearchRealName;
            } else {
                // 更新当前搜索条件
                currentSearchRealName = realName;
            }
            
            let url = `/api/doctors?page=${page}&size=${doctorPageSize}`;
            if (realName && realName.trim() !== '') {
                url += `&realName=${encodeURIComponent(realName.trim())}`;
            }
            
            console.log('正在请求医生列表:', url);
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    console.log('收到医生列表响应:', data);
                    if (data.code === 200) {
                        updateDoctorTable(data.data.records);
                        updateDoctorPagination(data.data);
                    } else {
                        alert('获取医生列表失败: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('获取医生列表失败');
                });
        }
        
        // 更新医生表格
        function updateDoctorTable(doctors) {
            const tbody = document.querySelector('#doctorsPage tbody');
            tbody.innerHTML = '';
            
            doctors.forEach(doctor => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${doctor.id || ''}</td>
                    <td>${doctor.userId || ''}</td>
                    <td>${doctor.hospital || ''}</td>
                    <td>${doctor.department || ''}</td>
                    <td>${doctor.title || ''}</td>
                    <td>${doctor.specialty || ''}</td>
                    <td>
                        <div class="table-actions">
                            <button class="btn btn-outline view-doctor" data-id="${doctor.id}">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-outline edit-doctor" data-id="${doctor.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger delete-doctor" data-id="${doctor.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // 绑定事件
            bindDoctorActions();
        }
        
        // 更新医生分页信息
        function updateDoctorPagination(pageData) {
            const pageInfo = document.querySelector('#doctorsPage .page-info');
            const pageControls = document.querySelector('#doctorsPage .page-controls');
            const currentPageNum = document.querySelector('#doctorsPage #currentDoctorPageNum');
            const prevPageBtn = document.querySelector('#doctorsPage #prevDoctorPage');
            const nextPageBtn = document.querySelector('#doctorsPage #nextDoctorPage');
            
            // 计算总页数
            const totalPages = Math.ceil(pageData.total / pageData.pageSize);
            
            // 更新页面信息
            pageInfo.textContent = `显示 ${(pageData.currentPage - 1) * pageData.pageSize + 1} 到 ${Math.min(pageData.currentPage * pageData.pageSize, pageData.total)} 条记录，共 ${pageData.total} 条`;
            
            // 更新当前页码
            currentPageNum.textContent = pageData.currentPage;
            
            // 更新按钮状态
            prevPageBtn.disabled = pageData.currentPage <= 1;
            nextPageBtn.disabled = pageData.currentPage >= totalPages;
        }
        
        // 绑定医生操作事件
        function bindDoctorActions() {
            // 查看医生
            document.querySelectorAll('.view-doctor').forEach(btn => {
                btn.addEventListener('click', function() {
                    const doctorId = this.getAttribute('data-id');
                    viewDoctor(doctorId);
                });
            });
            
            // 编辑医生
            document.querySelectorAll('.edit-doctor').forEach(btn => {
                btn.addEventListener('click', function() {
                    const doctorId = this.getAttribute('data-id');
                    editDoctor(doctorId);
                });
            });
            
            // 删除医生
            document.querySelectorAll('.delete-doctor').forEach(btn => {
                btn.addEventListener('click', function() {
                    const doctorId = this.getAttribute('data-id');
                    deleteDoctor(doctorId);
                });
            });
        }
        
        // 查看医生详情
        function viewDoctor(doctorId) {
            fetch(`/api/doctors/${doctorId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200) {
                        const doctor = data.data;
                        alert(`医生详情:
ID: ${doctor.id || ''}
用户ID: ${doctor.userId || ''}
医院: ${doctor.hospital || ''}
科室: ${doctor.department || ''}
职称: ${doctor.title || ''}
专长: ${doctor.specialty || ''}
简介: ${doctor.introduction || ''}`);
                    } else {
                        alert('获取医生详情失败: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('获取医生详情失败');
                });
        }
        
        // 编辑医生
        function editDoctor(doctorId) {
            // 如果是医生登录，只能编辑自己的信息
            if (currentUser && currentUser.role === 'DOCTOR') {
                // 获取当前医生的信息
                fetch(`/api/doctors/user/${currentUser.id}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.code === 200) {
                            const doctor = data.data;
                            // 检查是否是当前医生的信息
                            if (doctor.id != doctorId) {
                                alert('您只能编辑自己的信息');
                                return;
                            }
                            // 填充表单数据
                            document.getElementById('doctorId').value = doctor.id || '';
                            document.getElementById('doctorUserId').value = doctor.userId || '';
                            document.getElementById('doctorHospital').value = doctor.hospital || '';
                            document.getElementById('doctorDepartment').value = doctor.department || '';
                            document.getElementById('doctorTitle').value = doctor.title || '';
                            document.getElementById('doctorSpecialty').value = doctor.specialty || '';
                            document.getElementById('doctorIntroduction').value = doctor.introduction || '';
                            
                            // 显示模态框
                            document.getElementById('doctorModalTitle').textContent = '编辑医生';
                            document.getElementById('doctorModal').style.display = 'block';
                        } else {
                            alert('获取医生信息失败: ' + data.message);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('获取医生信息失败');
                    });
                return;
            }
            
            fetch(`/api/doctors/${doctorId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200) {
                        const doctor = data.data;
                        // 填充表单数据
                        document.getElementById('doctorId').value = doctor.id || '';
                        document.getElementById('doctorUserId').value = doctor.userId || '';
                        document.getElementById('doctorHospital').value = doctor.hospital || '';
                        document.getElementById('doctorDepartment').value = doctor.department || '';
                        document.getElementById('doctorTitle').value = doctor.title || '';
                        document.getElementById('doctorSpecialty').value = doctor.specialty || '';
                        document.getElementById('doctorIntroduction').value = doctor.introduction || '';
                        
                        // 显示模态框
                        document.getElementById('doctorModalTitle').textContent = '编辑医生';
                        document.getElementById('doctorModal').style.display = 'block';
                    } else {
                        alert('获取医生信息失败: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('获取医生信息失败');
                });
        }
        
        // 删除医生
        function deleteDoctor(doctorId) {
            if (confirm('确定要删除这个医生吗？')) {
                fetch(`/api/doctors/${doctorId}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200) {
                        alert('医生删除成功');
                        // 重新加载医生列表
                        loadDoctorList(currentDoctorPage);
                    } else {
                        alert('删除医生失败: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('删除医生失败');
                });
            }
        }
        
        // 保存医生
        function saveDoctor() {
            // 如果是医生登录，只能更新自己的信息
            if (currentUser && currentUser.role === 'DOCTOR') {
                // 获取表单中的医生ID
                const doctorId = document.getElementById('doctorId').value;
                
                // 获取当前医生的信息
                fetch(`/api/doctors/user/${currentUser.id}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.code === 200) {
                            const currentDoctor = data.data;
                            // 检查是否是当前医生的信息
                            if (currentDoctor.id != doctorId) {
                                alert('您只能更新自己的信息');
                                return;
                            }
                            
                            // 继续保存操作
                            performSaveDoctor();
                        } else {
                            alert('获取医生信息失败: ' + data.message);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('获取医生信息失败');
                    });
                return;
            }
            
            // 管理员或其他角色可以直接保存
            performSaveDoctor();
        }
        
        // 执行保存医生的实际操作
        function performSaveDoctor() {
            const doctorId = document.getElementById('doctorId').value;
            const doctor = {
                userId: parseInt(document.getElementById('doctorUserId').value),
                hospital: document.getElementById('doctorHospital').value,
                department: document.getElementById('doctorDepartment').value,
                title: document.getElementById('doctorTitle').value,
                specialty: document.getElementById('doctorSpecialty').value,
                introduction: document.getElementById('doctorIntroduction').value
            };
            
            let url = '/api/doctors';
            let method = 'POST';
            
            // 如果是更新操作
            if (doctorId && doctorId !== '') {
                doctor.id = parseInt(doctorId);
                method = 'PUT';
            }
            
            // 发送请求
            fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(doctor)
            })
            .then(response => response.json())
            .then(data => {
                if (data.code === 200) {
                    alert(doctorId ? '医生更新成功' : '医生添加成功');
                    closeDoctorModal();
                    // 重新加载医生列表
                    loadDoctorList(currentDoctorPage);
                } else {
                    alert((doctorId ? '更新' : '添加') + '医生失败: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert((doctorId ? '更新' : '添加') + '医生失败: ' + (error.message || '网络错误'));
            });
        }
        
        // 关闭医生模态框
        function closeDoctorModal() {
            document.getElementById('doctorModal').style.display = 'none';
            // 清空表单
            document.getElementById('doctorForm').reset();
            // 特别清空医生ID字段
            document.getElementById('doctorId').value = '';
        }
        
        // 绑定医生模态框事件
        document.getElementById('closeDoctorModal').addEventListener('click', closeDoctorModal);
        document.getElementById('cancelDoctorBtn').addEventListener('click', closeDoctorModal);
        document.getElementById('saveDoctorBtn').addEventListener('click', saveDoctor);
        
        // 点击医生模态框外部关闭
        document.getElementById('doctorModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeDoctorModal();
            }
        });
        
        // 绑定医生查询按钮事件
        document.getElementById('searchDoctorBtn').addEventListener('click', function() {
            const realName = document.getElementById('doctorRealName').value;
            loadDoctorList(1, realName);
        });
        
        // 绑定医生重置按钮事件
        document.getElementById('resetDoctorBtn').addEventListener('click', function() {
            document.getElementById('doctorRealName').value = '';
            currentSearchRealName = '';
            loadDoctorList(1);
        });
        
        // 当切换到医生管理页面时加载数据
        document.querySelector('[data-page="doctors"]').addEventListener('click', function() {
            loadDoctorList(1);
        });
        
        // 预约管理功能
        let currentAppointmentPage = 1;
        const appointmentPageSize = 10;
        let currentAppointmentSearchUserRealName = ''; // 保存当前搜索的用户姓名
        
        // 查询预约列表
        function loadAppointmentList(page = 1, userRealName = '') {
            currentAppointmentPage = page;
            // 如果没有传入userRealName参数，则使用当前保存的搜索条件
            if (arguments.length === 1) {
                userRealName = currentAppointmentSearchUserRealName;
            } else {
                // 更新当前搜索条件
                currentAppointmentSearchUserRealName = userRealName;
            }
            
            // 构造URL，医生只能看到预约给自己的数据
            let url = `/api/appointments?page=${page}&size=${appointmentPageSize}`;
            if (userRealName && userRealName.trim() !== '') {
                url += `&userRealName=${encodeURIComponent(userRealName.trim())}`;
            }
            
            // 如果是医生登录，只显示预约给自己的数据
            if (currentUser && currentUser.role === 'DOCTOR') {
                url += `&doctorId=${currentUser.id}`;
            }
            
            console.log('正在请求预约列表:', url);
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    console.log('收到预约列表响应:', data);
                    if (data.code === 200) {
                        updateAppointmentTable(data.data.records);
                        updateAppointmentPagination(data.data);
                    } else {
                        alert('获取预约列表失败: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('获取预约列表失败');
                });
        }
        
        // 更新预约表格
        function updateAppointmentTable(appointments) {
            const tbody = document.querySelector('#appointmentsPage tbody');
            tbody.innerHTML = '';
            
            appointments.forEach(appointment => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${appointment.id || ''}</td>
                    <td>${appointment.userName || ''}</td>
                    <td>${appointment.hospital || ''}</td>
                    <td>${appointment.department || ''}</td>
                    <td>${appointment.doctorTitle || ''}</td>
                    <td>${formatDate(appointment.appointmentTime) || ''}</td>
                    <td><span class="tag ${appointment.status === 1 ? 'tag-success' : 'tag-warning'}">${appointment.status === 1 ? '已确认' : '待确认'}</span></td>
                    <td>
                        <div class="table-actions">
                            <button class="btn btn-outline view-appointment" data-id="${appointment.id}">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-outline edit-appointment" data-id="${appointment.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // 绑定事件
            bindAppointmentActions();
        }
        
        // 格式化日期
        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('zh-CN');
        }
        
        // 更新预约分页信息
        function updateAppointmentPagination(pageData) {
            const pageInfo = document.querySelector('#appointmentsPage .page-info');
            const pageControls = document.querySelector('#appointmentsPage .page-controls');
            const currentPageNum = document.querySelector('#appointmentsPage #currentAppointmentPageNum');
            const prevPageBtn = document.querySelector('#appointmentsPage #prevAppointmentPage');
            const nextPageBtn = document.querySelector('#appointmentsPage #nextAppointmentPage');
            
            // 计算总页数
            const totalPages = Math.ceil(pageData.total / pageData.pageSize);
            
            // 更新页面信息
            pageInfo.textContent = `显示 ${(pageData.currentPage - 1) * pageData.pageSize + 1} 到 ${Math.min(pageData.currentPage * pageData.pageSize, pageData.total)} 条记录，共 ${pageData.total} 条`;
            
            // 更新当前页码
            currentPageNum.textContent = pageData.currentPage;
            
            // 更新按钮状态
            prevPageBtn.disabled = pageData.currentPage <= 1;
            nextPageBtn.disabled = pageData.currentPage >= totalPages;
        }
        
        // 绑定预约操作事件
        function bindAppointmentActions() {
            // 查看预约
            document.querySelectorAll('.view-appointment').forEach(btn => {
                btn.addEventListener('click', function() {
                    const appointmentId = this.getAttribute('data-id');
                    viewAppointment(appointmentId);
                });
            });
            
            // 编辑预约
            document.querySelectorAll('.edit-appointment').forEach(btn => {
                btn.addEventListener('click', function() {
                    const appointmentId = this.getAttribute('data-id');
                    editAppointment(appointmentId);
                });
            });
        }
        
        // 查看预约详情
        function viewAppointment(appointmentId) {
            fetch(`/api/appointments/${appointmentId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200) {
                        const appointment = data.data;
                        alert(`预约详情:
ID: ${appointment.id || ''}
用户: ${appointment.userName || ''}
医院: ${appointment.hospital || ''}
科室: ${appointment.department || ''}
医生职称: ${appointment.doctorTitle || ''}
预约时间: ${formatDate(appointment.appointmentTime) || ''}
状态: ${appointment.status === 1 ? '已确认' : '待确认'}`);
                    } else {
                        alert('获取预约详情失败: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('获取预约详情失败');
                });
        }
        
        // 编辑预约
        function editAppointment(appointmentId) {
            fetch(`/api/appointments/${appointmentId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200) {
                        const appointment = data.data;
                        // 这里可以打开编辑模态框并填充数据
                        alert(`预约信息:
ID: ${appointment.id || ''}
用户: ${appointment.userName || ''}
医院: ${appointment.hospital || ''}
科室: ${appointment.department || ''}
医生职称: ${appointment.doctorTitle || ''}
预约时间: ${formatDate(appointment.appointmentTime) || ''}
状态: ${appointment.status === 1 ? '已确认' : '待确认'}

这里应该打开编辑模态框，但为了简化示例，我们只显示信息。`);
                    } else {
                        alert('获取预约信息失败: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('获取预约信息失败');
                });
        }
        
        // 绑定预约查询按钮事件
        document.getElementById('searchAppointmentBtn').addEventListener('click', function() {
            const userRealName = document.getElementById('appointmentUserRealName').value;
            loadAppointmentList(1, userRealName);
        });
        
        // 绑定预约重置按钮事件
        document.getElementById('resetAppointmentBtn').addEventListener('click', function() {
            document.getElementById('appointmentUserRealName').value = '';
            currentAppointmentSearchUserRealName = '';
            loadAppointmentList(1);
        });
        
        // 当切换到预约管理页面时加载数据
        document.querySelector('[data-page="appointments"]').addEventListener('click', function() {
            loadAppointmentList(1);
        });
        
        // 知识管理功能
        let currentKnowledgePage = 1;
        const knowledgePageSize = 10;
        let currentKnowledgeSearchTitle = ''; // 保存当前搜索的标题
        
        // 查询知识列表
        function loadKnowledgeList(page = 1, title = '') {
            currentKnowledgePage = page;
            // 如果没有传入title参数，则使用当前保存的搜索条件
            if (arguments.length === 1) {
                title = currentKnowledgeSearchTitle;
            } else {
                // 更新当前搜索条件
                currentKnowledgeSearchTitle = title;
            }
            
            let url = `/api/knowledge?page=${page}&size=${knowledgePageSize}`;
            if (title && title.trim() !== '') {
                url += `&title=${encodeURIComponent(title.trim())}`;
            }
            
            console.log('正在请求知识列表:', url);
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    console.log('收到知识列表响应:', data);
                    if (data.code === 200) {
                        updateKnowledgeTable(data.data.records);
                        updateKnowledgePagination(data.data);
                    } else {
                        alert('获取知识列表失败: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('获取知识列表失败');
                });
        }
        
        // 更新知识表格
        function updateKnowledgeTable(knowledges) {
            const tbody = document.querySelector('#knowledgePage tbody');
            tbody.innerHTML = '';
            
            knowledges.forEach(knowledge => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${knowledge.id || ''}</td>
                    <td>${knowledge.title || ''}</td>
                    <td>${knowledge.category || ''}</td>
                    <td><span class="tag ${knowledge.status === 1 ? 'tag-success' : 'tag-warning'}">${knowledge.status === 1 ? '已发布' : '草稿'}</span></td>
                    <td>${formatDate(knowledge.createTime) || ''}</td>
                    <td>
                        <div class="table-actions">
                            <button class="btn btn-outline view-knowledge" data-id="${knowledge.id}">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-outline edit-knowledge" data-id="${knowledge.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger delete-knowledge" data-id="${knowledge.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // 绑定事件
            bindKnowledgeActions();
        }
        
        // 更新知识分页信息
        function updateKnowledgePagination(pageData) {
            const pageInfo = document.querySelector('#knowledgePage .page-info');
            const pageControls = document.querySelector('#knowledgePage .page-controls');
            const currentPageNum = document.querySelector('#knowledgePage #currentKnowledgePageNum');
            const prevPageBtn = document.querySelector('#knowledgePage #prevKnowledgePage');
            const nextPageBtn = document.querySelector('#knowledgePage #nextKnowledgePage');
            
            // 计算总页数
            const totalPages = Math.ceil(pageData.total / pageData.pageSize);
            
            // 更新页面信息
            pageInfo.textContent = `显示 ${(pageData.currentPage - 1) * pageData.pageSize + 1} 到 ${Math.min(pageData.currentPage * pageData.pageSize, pageData.total)} 条记录，共 ${pageData.total} 条`;
            
            // 更新当前页码
            currentPageNum.textContent = pageData.currentPage;
            
            // 更新按钮状态
            prevPageBtn.disabled = pageData.currentPage <= 1;
            nextPageBtn.disabled = pageData.currentPage >= totalPages;
        }
        
        // 绑定知识操作事件
        function bindKnowledgeActions() {
            // 查看知识
            document.querySelectorAll('.view-knowledge').forEach(btn => {
                btn.addEventListener('click', function() {
                    const knowledgeId = this.getAttribute('data-id');
                    viewKnowledge(knowledgeId);
                });
            });
            
            // 编辑知识
            document.querySelectorAll('.edit-knowledge').forEach(btn => {
                btn.addEventListener('click', function() {
                    const knowledgeId = this.getAttribute('data-id');
                    editKnowledge(knowledgeId);
                });
            });
            
            // 删除知识
            document.querySelectorAll('.delete-knowledge').forEach(btn => {
                btn.addEventListener('click', function() {
                    const knowledgeId = this.getAttribute('data-id');
                    deleteKnowledge(knowledgeId);
                });
            });
        }
        
        // 查看知识详情
        function viewKnowledge(knowledgeId) {
            fetch(`/api/knowledge/${knowledgeId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200) {
                        const knowledge = data.data;
                        alert(`知识详情:
ID: ${knowledge.id || ''}
标题: ${knowledge.title || ''}
分类: ${knowledge.category || ''}
状态: ${knowledge.status === 1 ? '已发布' : '草稿'}
创建时间: ${formatDate(knowledge.createTime) || ''}`);
                    } else {
                        alert('获取知识详情失败: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('获取知识详情失败');
                });
        }
        
        // 编辑知识
        function editKnowledge(knowledgeId) {
            fetch(`/api/knowledge/${knowledgeId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200) {
                        const knowledge = data.data;
                        // 这里可以打开编辑模态框并填充数据
                        alert(`知识信息:
ID: ${knowledge.id || ''}
标题: ${knowledge.title || ''}
分类: ${knowledge.category || ''}
状态: ${knowledge.status === 1 ? '已发布' : '草稿'}
创建时间: ${formatDate(knowledge.createTime) || ''}

这里应该打开编辑模态框，但为了简化示例，我们只显示信息。`);
                    } else {
                        alert('获取知识信息失败: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('获取知识信息失败');
                });
        }
        
        // 删除知识
        function deleteKnowledge(knowledgeId) {
            if (confirm('确定要删除这个知识吗？')) {
                fetch(`/api/knowledge/${knowledgeId}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200) {
                        alert('知识删除成功');
                        // 重新加载知识列表
                        loadKnowledgeList(currentKnowledgePage);
                    } else {
                        alert('删除知识失败: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('删除知识失败');
                });
            }
        }
        
        // 绑定知识查询按钮事件
        document.getElementById('searchKnowledgeBtn').addEventListener('click', function() {
            const title = document.getElementById('knowledgeTitle').value;
            loadKnowledgeList(1, title);
        });
        
        // 绑定知识重置按钮事件
        document.getElementById('resetKnowledgeBtn').addEventListener('click', function() {
            document.getElementById('knowledgeTitle').value = '';
            currentKnowledgeSearchTitle = '';
            loadKnowledgeList(1);
        });
        
        // 当切换到知识管理页面时加载数据
        document.querySelector('[data-page="knowledge"]').addEventListener('click', function() {
            loadKnowledgeList(1);
        });
        
        // 绑定添加知识按钮事件
        document.getElementById('addKnowledgeBtn').addEventListener('click', function() {
            // 这里应该打开添加知识的模态框
            alert('添加知识功能待实现');
        });
        
        // 咨询管理功能
        let currentConsultationPage = 1;
        const consultationPageSize = 10;
        let currentConsultationSearchTitle = ''; // 保存当前搜索的标题
        let currentConsultationSearchStatus = ''; // 保存当前搜索的状态
        
        // 查询咨询列表
        function loadConsultationList(page = 1, title = '', status = '') {
            currentConsultationPage = page;
            // 如果没有传入参数，则使用当前保存的搜索条件
            if (arguments.length === 1) {
                title = currentConsultationSearchTitle;
                status = currentConsultationSearchStatus;
            } else {
                // 更新当前搜索条件
                currentConsultationSearchTitle = title;
                currentConsultationSearchStatus = status;
            }
            
            // 构造URL，医生只能看到咨询自己的数据
            let url = `/api/consultations?page=${page}&size=${consultationPageSize}`;
            if (title && title.trim() !== '') {
                url += `&title=${encodeURIComponent(title.trim())}`;
            }
            if (status !== '') {
                url += `&status=${status}`;
            }
            
            // 如果是医生登录，只显示咨询自己的数据
            if (currentUser && currentUser.role === 'DOCTOR') {
                url += `&doctorId=${currentUser.id}`;
            }
            
            console.log('正在请求咨询列表:', url);
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    console.log('收到咨询列表响应:', data);
                    if (data.code === 200) {
                        updateConsultationTable(data.data.records);
                        updateConsultationPagination(data.data);
                    } else {
                        alert('获取咨询列表失败: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('获取咨询列表失败');
                });
        }
        
        // 更新咨询表格
        function updateConsultationTable(consultations) {
            const tbody = document.querySelector('#consultationsPage tbody');
            tbody.innerHTML = '';
            
            consultations.forEach(consultation => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${consultation.id || ''}</td>
                    <td>${consultation.userName || ''}</td>
                    <td>${consultation.doctorName || ''}</td>
                    <td>${consultation.title || ''}</td>
                    <td><span class="tag ${consultation.status === 1 ? 'tag-success' : 'tag-warning'}">${consultation.status === 1 ? '已回复' : '未回复'}</span></td>
                    <td>${formatDate(consultation.createTime) || ''}</td>
                    <td>
                        <div class="table-actions">
                            <button class="btn btn-outline view-consultation" data-id="${consultation.id}">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-outline reply-consultation" data-id="${consultation.id}">
                                <i class="fas fa-reply"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // 绑定事件
            bindConsultationActions();
        }
        
        // 更新咨询分页信息
        function updateConsultationPagination(pageData) {
            const pageInfo = document.querySelector('#consultationsPage .page-info');
            const pageControls = document.querySelector('#consultationsPage .page-controls');
            const currentPageNum = document.querySelector('#consultationsPage #currentConsultationPageNum');
            const prevPageBtn = document.querySelector('#consultationsPage #prevConsultationPage');
            const nextPageBtn = document.querySelector('#consultationsPage #nextConsultationPage');
            
            // 计算总页数
            const totalPages = Math.ceil(pageData.total / pageData.pageSize);
            
            // 更新页面信息
            pageInfo.textContent = `显示 ${(pageData.currentPage - 1) * pageData.pageSize + 1} 到 ${Math.min(pageData.currentPage * pageData.pageSize, pageData.total)} 条记录，共 ${pageData.total} 条`;
            
            // 更新当前页码
            currentPageNum.textContent = pageData.currentPage;
            
            // 更新按钮状态
            prevPageBtn.disabled = pageData.currentPage <= 1;
            nextPageBtn.disabled = pageData.currentPage >= totalPages;
        }
        
        // 绑定咨询操作事件
        function bindConsultationActions() {
            // 查看咨询
            document.querySelectorAll('.view-consultation').forEach(btn => {
                btn.addEventListener('click', function() {
                    const consultationId = this.getAttribute('data-id');
                    viewConsultation(consultationId);
                });
            });
            
            // 回复咨询
            document.querySelectorAll('.reply-consultation').forEach(btn => {
                btn.addEventListener('click', function() {
                    const consultationId = this.getAttribute('data-id');
                    replyConsultation(consultationId);
                });
            });
        }
        
        // 查看咨询详情
        function viewConsultation(consultationId) {
            fetch(`/api/consultations/${consultationId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200) {
                        const consultation = data.data;
                        alert(`咨询详情:
ID: ${consultation.id || ''}
用户: ${consultation.userName || ''}
医生: ${consultation.doctorName || ''}
标题: ${consultation.title || ''}
内容: ${consultation.content || ''}
状态: ${consultation.status === 1 ? '已回复' : '未回复'}
创建时间: ${formatDate(consultation.createTime) || ''}
回复内容: ${consultation.reply || ''}`);
                    } else {
                        alert('获取咨询详情失败: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('获取咨询详情失败');
                });
        }
        
        // 回复咨询
        function replyConsultation(consultationId) {
            fetch(`/api/consultations/${consultationId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.code === 200) {
                        const consultation = data.data;
                        // 这里可以打开回复模态框并填充数据
                        alert(`咨询信息:
ID: ${consultation.id || ''}
用户: ${consultation.userName || ''}
医生: ${consultation.doctorName || ''}
标题: ${consultation.title || ''}
内容: ${consultation.content || ''}
状态: ${consultation.status === 1 ? '已回复' : '未回复'}
创建时间: ${formatDate(consultation.createTime) || ''}

这里应该打开回复模态框，但为了简化示例，我们只显示信息。`);
                    } else {
                        alert('获取咨询信息失败: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('获取咨询信息失败');
                });
        }
        
        // 绑定咨询查询按钮事件
        document.getElementById('searchConsultationBtn').addEventListener('click', function() {
            const title = document.getElementById('consultationTitle').value;
            const status = document.getElementById('consultationStatus').value;
            loadConsultationList(1, title, status);
        });
        
        // 绑定咨询重置按钮事件
        document.getElementById('resetConsultationBtn').addEventListener('click', function() {
            document.getElementById('consultationTitle').value = '';
            document.getElementById('consultationStatus').value = '';
            currentConsultationSearchTitle = '';
            currentConsultationSearchStatus = '';
            loadConsultationList(1);
        });
        
        // 当切换到知识管理页面时加载数据
        document.querySelector('[data-page="knowledge"]').addEventListener('click', function() {
            loadKnowledgeList(1);
        });
        
        // 绑定添加知识按钮事件
        document.getElementById('addKnowledgeBtn').addEventListener('click', function() {
            // 这里应该打开添加知识的模态框
            alert('添加知识功能待实现');
        });
        
        // 当切换到咨询管理页面时加载数据
        document.querySelector('[data-page="consultations"]').addEventListener('click', function() {
            // 清空搜索条件
            document.getElementById('consultationTitle').value = '';
            document.getElementById('consultationStatus').value = '';
            currentConsultationSearchTitle = '';
            currentConsultationSearchStatus = '';
            loadConsultationList(1);
        });
        
        // 绑定添加咨询按钮事件
        document.getElementById('addConsultationBtn').addEventListener('click', function() {
            // 这里应该打开添加咨询的模态框
            alert('添加咨询功能待实现');
        });
    </script>
</body>
</html>